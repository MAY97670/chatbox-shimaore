<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat Shimaore</title>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet">
  <style>
    * {
     margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Baloo 2', cursive;
  background: linear-gradient(to bottom, #e6f2ff, #ffffff);
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

/* === WRAPPER === */
#chatbot-wrapper {
  width: 90%;
  max-width: 500px;
  padding: 10px;
}

/* === CHAT CONTAINER === */
#chat-container {
  background: white;
  border-radius: 20px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

#chat-box {
  height: 280px;
  overflow-y: auto;
  padding: 15px;
  display: flex;
  flex-direction: column;
}

.bubble {
  padding: 10px 14px;
  margin: 6px 0;
  border-radius: 15px;
  max-width: 75%;
  line-height: 1.4;
  word-wrap: break-word;
}

.user {
  background: linear-gradient(to right, #007bff, #3399ff);
  color: white;
  align-self: flex-end;
  border-bottom-right-radius: 5px;
}

.bot {
  background: #f1f1f1;
  color: #333;
  align-self: flex-start;
  border-bottom-left-radius: 5px;
}

/* === INPUT ET BOUTONS CHAT === */
#user-input {
  border: none;
  border-top: 1px solid #ddd;
  padding: 12px;
  outline: none;
  font-size: 14px;
  width: calc(100% - 24px);
}

.button-container {
  display: flex;
  border-top: 1px solid #ddd;
  background: #fafafa;
}

.button-container button {
  flex: 1;
  padding: 12px;
  border: none;
  background: #007bff;
  color: white;
  cursor: pointer;
  font-size: 14px;
}

.button-container button:hover {
  background: #0056b3;
}

/* === LOADING INDICATOR === */
#loading-indicator {
  display: none;
  justify-content: flex-start;
  margin: 5px 0;
}

.dot {
  width: 8px;
  height: 8px;
  margin: 0 3px;
  background-color: #007bff;
  border-radius: 50%;
  display: inline-block;
  animation: bounce 1.4s infinite ease-in-out both;
}

.dot:nth-child(1) { animation-delay: -0.32s; }
.dot:nth-child(2) { animation-delay: -0.16s; }

@keyframes bounce {
  0%, 80%, 100% { transform: scale(0); }
  40% { transform: scale(1); }
}

/* === COMMENTAIRE === */
#comment-container {
  margin-top: 20px;
  display: flex;
  flex-direction: column;
}

#comment-container h2 {
  text-align: center;
  color: #28a745;
  margin-bottom: 10px;
}

#user-comment {
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ccc;
  resize: vertical;
  font-family: 'Baloo 2', cursive;
  margin-bottom: 10px;
}

#comment-container button {
  padding: 10px;
  border: none;
  border-radius: 10px;
  background-color: #28a745;
  color: white;
  cursor: pointer;
  font-size: 14px;
}

#comment-container button:hover {
  background-color: #218838;
}

function sendComment() {
  try {
    const comment = document.getElementById("user-comment").value.trim();
    if (!comment) return;

    // Affichage dans le chat
    const chatBox = document.getElementById("chat-box");
    const commentBubble = document.createElement("div");
    commentBubble.className = "bubble user";
    commentBubble.style.background = "#28a745"; // couleur spéciale commentaire
    commentBubble.textContent = comment;
    chatBox.appendChild(commentBubble);
    chatBox.scrollTop = chatBox.scrollHeight;

    // URL du script Google Apps
    const scriptURL = "https://script.google.com/macros/s/AKfycbzh6zDVopGcuoTZNJ0PzOwkjiCIBCaNFs_oioYKAj8NUQ3izxC9xNuAA4YawFH2P35qqQ/exec";

    // Envoi au script
    fetch(scriptURL, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({ comment: comment })
    })
    .then(resp => resp.text()) // ← on prend en texte (plus sûr que .json)
    .then(data => {
      console.log("Réponse serveur :", data);
      alert("✅ Ton commentaire a bien été envoyé !");
    })
    .catch(err => {
      console.error("Erreur envoi commentaire:", err);
      alert("⚠️ Impossible d’envoyer le commentaire. Réessaie plus tard.");
    });

    // Réinitialise la case
    document.getElementById("user-comment").value = '';
  } catch (e) {
    console.error("Erreur dans sendComment :", e);
  }
